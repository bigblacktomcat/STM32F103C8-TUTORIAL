# STM32F103C8-TUTORIAL
ADC DMA 10 kHz tutorial sample with USB and PWM output
This is simple example of code for STM32F103C8
My program uses ADC via DMA. One channel with 10 kHz sampling due to timer.
Each 10 mc average value from ADC appear with PWM. And each 1c via USB.

Небольшая учебная программа для тестовой платы на STM32F103C8T6.
Назначение программы: 
1. С частотой 10 кГц, по таймеру, программа опрашивает один канал ADC 
2. Результаты измерений помещаются в буфер с использованием DMA
3. По заполнению буфера (100 слов), вычисляется среднее значение за 10 мс
4. Полученное среднее значение выводится PWM на один из выводов.
5. Вычисляется среднее значение измерений за 1с и выводится через USB, на VCP в текстовом виде
6. Это же среднее значение выводится через SWD (по отладке) в среду Keil uVision.

Благодаря STM32CubeMX все делается достаточно просто. Большая часть программирования выполненна автоматической средой. Ручной код получается очень компактным и весь сосредоточен в файле main.c .
Принцип работы платы очень прост. На вход ADC1 IN1 (PA1, pin11) поступает измеряемое напряжение. С помощью таймера TIM3 channel 4 организован циклический опрос ADC1 IN1 с частотой 10 кГц и загрузкой измеренных значений с помощью DMA1 в буфер. По заполнению буфера вызывается HAL_ADC_ConvCpltCallback() и переводит переменную convCompleted в True. При этом мы находим среднее арифметическое bufferADC за 10 мс.
Полученное значение мы выводим через pin PB6 используя PWM реализованный на таймере TIM4 channel 1.
Проведя 100 циклов по 10 мс мы находим среднее значение за 1с мы выводим результат через USB VCP в текстовом виде, в формате типа "1500 mV \r". Вывод результата мы дублируем в окно отладчика Keil через SWD.
